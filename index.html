<!DOCTYPE html>
<html>

<head>
<meta name="viewport" content="width=device-width, initial-scale=0.5, maximum-scale=0.5, user-scalable=no, target-densitydpi=device-dpi"/>
<link rel="stylesheet" type="text/css" href="css/index.css" />
<title>ArduinoMotoDash</title>
</head>
	<body>

	<!-- Заставка -->
	<div id="splash">
		<div id="progressbar">
			<div id="progress"></div>
		</div>
	</div>

	<!-- Подключение -->
	<div id="connection">
		<div id="content">
			<div id="connection_btns">

				<select id="deviceList">
					<option>Discovering</option>
				</select>

				<a id="connectButton">Connect</a>

				<a id="listButton">Device list</a>

				<div id="statusMessage">Status</div>

				<a id="disconnectButton">Disconnect</a>
				<a id="view">View</a>
			</div>
			<div id="chat">
				<form id="chatform">
				<input type="text" id="message" placeholder="Message" />
				<a id="sendButton">Send</a>
					<textarea id="messages" readonly>123</textarea>
						
					
				</form>
				<div class="center">
					
				</div>
			</div>
		</div>
	</div>
		

		<div id="dash_container">

			<div style="position: absolute">
				<div id="sensor"></div>
				<div id="sensor_2"></div>
				<div id="sensor_3"></div>
			</div>

			
			<canvas id="dash" width="1184" height="720"></canvas>
			<div id="speed">---</div>
			<div id="rpm">---</div>
			<canvas id="temp"></canvas>
			<div id="timestamp">---</div>
			<div id="input_1">1---</div>
			<div id="input_2">2---</div>
			<div id="input_3">3---</div>
		</div>

		<script type="text/javascript" src="cordova.js"></script>
		<script type="text/javascript" src="js/bluetoothSerial.js"></script>
		<script type="text/javascript" src="js/index.js"></script>
		<script type="text/javascript" src="js/jquery.js"></script>
		<script type="text/javascript" src="js/paper.js"></script>
		<script type="text/javascript" src="js/dash.js"></script>
		<script type="text/javascript">
		
		</script>
	</body>
</html>

<script>

	var path;
	var points;
	var dash;
	var tacho;
	//Переменные тахометра
	var tacho_sensor_length = 100;
	var tacho_delay_array = new Array();
	var tacho_impulse_old = 0;
	//Переменные спидометра
	var speed_sensor_length = 30;
	var speed_delay_array = new Array();
	var speed_impulse_old = 0;

	$(document).ready(function() {

	//Прогресс-бар и анимация заставки.
	$('#progress').animate({width: 280}, 2000);
	$('#splash').delay(2000).animate({marginTop: -720}, 500);

	$('#speed,#view').on('click', function(){
		$('#connection').toggleClass('hidden');
	});

		app.initialize();


		

		$.plugin('Dashboard', Dashboard);
		$('#dash_container').Dashboard();
		dash = $('#dash_container').data('Dashboard');

		setInterval(function(){
			var temp = Math.round((90 + Math.random() * 20)*10)/10;
			//Мгновеная температура каждые 10 сек
			dash.sensorTemp(temp);
			//dash.setSpeed(Math.round(temp));
		}, 1000);

		//onMessage
		//setInterval(function(){
		//	loop_1();
		//}, 25);

		//setInterval(function(){
		//	loop_2();
		//}, 500);

		//generatorTacho();
		//generatorSpeed();

	});

//function loop_1(){
//	a = Appromixation(tacho_delay_array);
//	dash.sensorTacho(a);
//}

//function loop_2(){
//	b = Appromixation(speed_delay_array);
//	dash.setSpeed(b);
//}

function Appromixation(array){
	var min = array[0];
	var max = array[0];
	var array_summ = 0;
	for (var i=0; i<array.length; i++){
		if (max < array[i]){max = array[i]}
		if (min > array[i]){min = array[i]}
		array_summ = array_summ + array[i];
	}
	array_summ = array_summ - min - max;
	return array_summ/(array.length - 2);
}

function generatorTacho(){
	tacho_impulse_delay = Date.now() - tacho_impulse_old;
	tacho_impulse_old = Date.now();
	for (var i=0; i<tacho_sensor_length; i++){
		tacho_delay_array[i] = tacho_delay_array[i + 1];
	}
	tacho_delay_array[tacho_sensor_length - 1] = tacho_impulse_delay;
	setTimeout(function(){
		generatorTacho();
	}, 50);
}

function generatorSpeed(){
	speed_impulse_delay = Date.now() - speed_impulse_old;
	speed_impulse_old = Date.now();
	for (var i=0; i<speed_sensor_length; i++){
		speed_delay_array[i] = speed_delay_array[i + 1];
	}
	speed_delay_array[speed_sensor_length - 1] = speed_impulse_delay;
	setTimeout(function(){
		generatorSpeed();
	}, 50);
}

</script>



